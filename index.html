<!DOCTYPE html>
<html>
<head>
    <title>AR Weather Station (Touch Fix)</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <script>
        AFRAME.registerComponent('weather-controller', {
            init: function () {
                // อ้างอิง Element
                this.sun = document.querySelector('#sun-group');
                this.cloud = document.querySelector('#cloud-group');
                this.moon = document.querySelector('#moon-group');
                this.rain = document.querySelector('#rain-system');
                this.light = document.querySelector('#main-light');
                this.envColor = document.querySelector('#base-environment');

                // ฟังก์ชันผูกปุ่ม (Helper Function)
                const bindButton = (id, weatherType) => {
                    const btn = this.el.querySelector(id);
                    if (btn) {
                        btn.addEventListener('click', (evt) => {
                            console.log("Button clicked: " + weatherType); // เช็คใน Console
                            this.setWeather(weatherType);
                        });
                        // เพิ่ม Event สำหรับเมาส์/นิ้วแตะ เพื่อความชัวร์
                        btn.addEventListener('touchstart', (evt) => {
                            console.log("Touch start: " + weatherType);
                            this.setWeather(weatherType);
                        });
                    }
                };

                bindButton('#btn-sunny', 'sunny');
                bindButton('#btn-rainy', 'rainy');
                bindButton('#btn-night', 'night');
            },

            setWeather: function (type) {
                // 1. ซ่อนทุกอย่างก่อน
                this.sun.setAttribute('visible', false);
                this.cloud.setAttribute('visible', false);
                this.moon.setAttribute('visible', false);
                this.rain.setAttribute('visible', false);

                // 2. แสดงตามเงื่อนไข
                if (type === 'sunny') {
                    this.sun.setAttribute('visible', true);
                    this.light.setAttribute('light', 'color: #FFF; intensity: 1.2');
                    this.envColor.setAttribute('color', '#4CC3D9');
                } else if (type === 'rainy') {
                    this.cloud.setAttribute('visible', true);
                    this.rain.setAttribute('visible', true);
                    this.light.setAttribute('light', 'color: #889; intensity: 0.6');
                    this.envColor.setAttribute('color', '#5D6D7E');
                } else if (type === 'night') {
                    this.moon.setAttribute('visible', true);
                    this.light.setAttribute('light', 'color: #555; intensity: 0.4');
                    this.envColor.setAttribute('color', '#17202A');
                }
            }
        });
    </script>
</head>

<body style="margin: 0; overflow: hidden;">
    
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
        
        <a-entity id="main-light" light="type: directional; intensity: 1; castShadow: true" position="1 2 1"></a-entity>
        <a-entity light="type: ambient; intensity: 0.5"></a-entity>

        <a-marker preset="hiro" weather-controller cursor="rayOrigin: mouse" raycaster="objects: .clickable">
            
            <a-cylinder id="base-environment" position="0 0 0" radius="1.5" height="0.1" color="#4CC3D9" opacity="0.9"></a-cylinder>
            <a-cylinder position="0 -0.1 0" radius="1.45" height="0.3" color="#795548"></a-cylinder>

            <a-entity position="-0.8 0.5 -0.5">
                <a-cone color="#8D6E63" radius-bottom="0.1" radius-top="0.05" height="0.6"></a-cone>
                <a-dodecahedron color="#2ECC71" radius="0.4" position="0 0.4 0"></a-dodecahedron>
            </a-entity>
            <a-entity position="0.5 0.3 0">
                <a-box color="#F1C40F" depth="0.8" height="0.6" width="0.8"></a-box>
                <a-cone color="#E74C3C" radius-bottom="0.6" height="0.4" position="0 0.5 0" rotation="0 45 0"></a-cone>
            </a-entity>

            <a-entity id="sun-group" visible="true" position="0 2 -1">
                <a-sphere color="#F39C12" radius="0.4" animation="property: rotation; to: 0 360 0; loop: true; dur: 10000"></a-sphere>
            </a-entity>

            <a-entity id="cloud-group" visible="false" position="0 1.8 0">
                <a-sphere color="#BDC3C7" radius="0.3" position="-0.3 0 0"></a-sphere>
                <a-sphere color="#BDC3C7" radius="0.4" position="0 0.1 0"></a-sphere>
                <a-sphere color="#BDC3C7" radius="0.3" position="0.3 0 0"></a-sphere>
            </a-entity>
            <a-entity id="rain-system" visible="false">
                 <a-cylinder color="#3498DB" height="0.1" radius="0.01" position="-0.5 1 0.5" animation="property: position; to: -0.5 0 0.5; loop: true; dur: 500"></a-cylinder>
                 <a-cylinder color="#3498DB" height="0.1" radius="0.01" position="0 1.5 0.8" animation="property: position; to: 0 0 0.8; loop: true; dur: 400"></a-cylinder>
            </a-entity>

            <a-entity id="moon-group" visible="false" position="0 2 -1">
                <a-sphere color="#F0F3F4" radius="0.3"></a-sphere>
            </a-entity>

            <a-entity position="0 0.5 1.5" rotation="-45 0 0">
                
                <a-entity id="btn-sunny" class="clickable" position="-0.8 0 0"
                          animation__click="property: scale; startEvents: click; from: 1 1 1; to: 0.9 0.9 0.9; dur: 100; dir: alternate">
                    <a-box color="#F39C12" depth="0.1" height="0.3" width="0.6"></a-box>
                    <a-text value="SUN" align="center" z-offset="0.06" scale="0.8 0.8 0.8"></a-text>
                </a-entity>
                
                <a-entity id="btn-rainy" class="clickable" position="0 0 0"
                          animation__click="property: scale; startEvents: click; from: 1 1 1; to: 0.9 0.9 0.9; dur: 100; dir: alternate">
                    <a-box color="#3498DB" depth="0.1" height="0.3" width="0.6"></a-box>
                    <a-text value="RAIN" align="center" z-offset="0.06" scale="0.8 0.8 0.8"></a-text>
                </a-entity>
                
                <a-entity id="btn-night" class="clickable" position="0.8 0 0"
                          animation__click="property: scale; startEvents: click; from: 1 1 1; to: 0.9 0.9 0.9; dur: 100; dir: alternate">
                    <a-box color="#2C3E50" depth="0.1" height="0.3" width="0.6"></a-box>
                    <a-text value="NIGHT" align="center" z-offset="0.06" color="white" scale="0.8 0.8 0.8"></a-text>
                </a-entity>
            </a-entity>

        </a-marker>

        <a-entity camera>
            <a-entity cursor="fuse: false; rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>
        </a-entity>

    </a-scene>
</body>
</html>